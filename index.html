<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: whitesmoke;
        }

        canvas {
            /* border: 2px solid rgb(255, 102, 0); */
            box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.302);
            margin: center;
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
            border-radius: 3px;
            /* image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated; */
            cursor: pointer;
        }

        #title {
            text-align: center;
            width: 100%;
            padding: 20px;
            font-weight: 600;
            font-size: 20px;
            color: #ff6600;
            text-shadow: 0px 0px 2px rgba(0, 0, 0, 0.542);
            box-shadow: 0px 1px 5px rgba(0, 0, 0, 0.268);
            margin-bottom: 40px;
            background-color: white;
        }

        #console {
            width: 100%;
            height: 300px;
            padding: 20px;
            background-color: white;
            bottom: 0;
            position: absolute;
            box-shadow: 0px -1px 5px rgba(0, 0, 0, 0.268);
        }
    </style>
</head>

<body>
    <div id='title'>
        Compound Interest Savings Calculator
    </div>
    <canvas id='chart' width="1000" height="600"></canvas>

    <!-- <div id="console">
        <div id='container'>
            Console
            <div class='input'>
                <div class='input-name'>Annual Savings: </div>
                <input type='text'>
            </div>
        </div>
    </div> -->
    <script>
        //@copyright all rights reserved to Dominik SmÄ™da 2022

        const chart = document.getElementById('chart');
        const ctx = chart.getContext('2d');
        const WIDTH = chart.offsetWidth;
        const HEIGHT = chart.offsetHeight;

        const CHART_PADDING = 20;
        const LINE_COLOR = '#ff6600';
        const STEP_COLOR = '#ab59ac';
        const GRID_COLOR = '#00000011';
        const CHART_BACKGROUND = 'white';
        const CHART_DIVIDER = 2; //2^x amount of intermediate points per unit

        function sum(x, n) {
            // 1 + x^0 +x^1 +x^2 +... + x^n
            if (n <= 0)
                return n + 1;
            else {
                // console.log(x, n)
                return Math.pow(x, n) + sum(x, n - 1)
            }
        }

        function calcValue(years = 100, annualSavings = 54, rateOfReturn = 0.2) {
            return annualSavings * sum(1 + rateOfReturn, years);
        }


        function drawChart(fn, startX, endX, divider = CHART_DIVIDER) {

            let rangeX = endX - startX + 1;

            const step = 1 / divider;

            const width = WIDTH - 2 * CHART_PADDING;
            const height = HEIGHT - 2 * CHART_PADDING;

            ctx.save();
            ctx.fillStyle = CHART_BACKGROUND;
            ctx.fillRect(0, 0, WIDTH, HEIGHT);

            ctx.beginPath();
            ctx.strokeStyle = 'blue';
            ctx.moveTo(CHART_PADDING, HEIGHT - CHART_PADDING);

            const fMax = fn(endX);
            const fMin = fn(startX);
            const rangeY = fMax - fMin;


            for (let i = 0; i < ((endX - startX) * divider) + 1; i++) {
                let x = step * i;
                let y = fn(x);

                let chartX = (x * width / (rangeX - 1)) + CHART_PADDING;
                let chartY = HEIGHT - ((y - fMin) * height / rangeY) - CHART_PADDING;

                console.log(`x:${x}, y:${y} | chartX:${chartX}, chartY${chartY} | rangeY:${rangeY}`)

                ctx.lineTo(chartX, chartY)

                ctx.save();
                ctx.fillStyle = STEP_COLOR;
                ctx.fillRect(chartX - 2, chartY - 2, 4, 4);
                ctx.restore();
            }

            ctx.strokeStyle = LINE_COLOR;
            ctx.lineWidth = 1;
            ctx.stroke();

            ctx.restore();

            //GRID
            ctx.save();

            for (let i = 0; i < rangeX; i++) {
                ctx.beginPath();
                ctx.strokeStyle = GRID_COLOR;
                ctx.lineWidth = 1;
                ctx.moveTo(CHART_PADDING + i * width / (rangeX - 1), CHART_PADDING);
                ctx.lineTo(CHART_PADDING + i * width / (rangeX - 1), HEIGHT - CHART_PADDING);
                ctx.stroke();

                ctx.textAlign = 'center';
                ctx.fillStyle = 'black';
                ctx.fillText(i + startX, CHART_PADDING + i * width / (rangeX - 1), HEIGHT - CHART_PADDING / 2 + 2);
            }

            let range = rangeX * height / width;
            for (let i = 0; i < range; i++) {
                ctx.beginPath();
                ctx.strokeStyle = GRID_COLOR;
                ctx.lineWidth = 1;
                ctx.moveTo(CHART_PADDING, CHART_PADDING + i * height / range);
                ctx.lineTo(WIDTH - CHART_PADDING, CHART_PADDING + i * height / range);
                ctx.stroke();
            }

            ctx.restore();
        }

        function grid() {

        }

        let annualSavings = 54
        let rateOfReturn = 0.2
        drawChart(calcValue, 0, 12);

        window.saveChart = function () {
            let image = chart.toDataURL("image/png").replace("image/png", "image/octet-stream"); //Convert image to 'octet-stream' (Just a download, really)
            window.location.href = image;
        }

    </script>
</body>

</html>